<!-- inventory.html (גרסה מתוקנת ומחוברת ל-API) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory | DOUBLE ACTION</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; }
    header { background-color: #000; padding: 10px 0; }
    .navbar-brand img { height: 50px; }
    .navbar-nav .nav-link { color: #fff !important; margin-left: 15px; }
    .container { margin-top: 30px; }
    .alert-low { background-color: #fff3cd; }
  </style>
</head>
<body>

<header>
  <nav class="navbar navbar-expand-lg container">
    <a class="navbar-brand" href="index.html">
      <img src="A_logo_for_\"DOUBLE_ACTION\"_is_presented_on_a_white.png" alt="DOUBLE ACTION logo">
    </a>
    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link active" href="inventory.html">Inventory</a></li>
        <li class="nav-item"><a class="nav-link" href="orders.html">Orders</a></li>
        <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html">Logout</a></li>
      </ul>
    </div>
  </nav>
</header>

<div class="container">
  <h2 class="mb-4">Inventory Management</h2>
  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Name</th>
        <th>Category</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Min Quantity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="inventoryTable"></tbody>
  </table>
  <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#itemModal" onclick="openAddModal()">Add Item</button>
</div>

<!-- Modal -->
<div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="itemModalLabel">Add/Edit Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="itemForm">
          <input type="hidden" id="editId">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" id="itemName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" id="itemCategory" required>
              <option value="">Select Category</option>
              <option value="Fabrics">Fabrics</option>
              <option value="Pants">Pants</option>
              <option value="Vests">Vests</option>
              <option value="Jackets">Jackets</option>
              <option value="Shirts">Shirts</option>
              <option value="Ties">Ties</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" id="itemQuantity" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Price</label>
            <input type="number" class="form-control" id="itemPrice" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Min Quantity</label>
            <input type="number" class="form-control" id="itemMinQuantity" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" onclick="saveItem()">Save</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const API_URL = "http://127.0.0.1:5000/products";

  function openAddModal() {
    document.getElementById("itemForm").reset();
    document.getElementById("editId").value = "";
    document.getElementById("itemModalLabel").textContent = "Add Item";
  }

  function openEditModal(item) {
    document.getElementById("editId").value = item.product_id;
    document.getElementById("itemName").value = item.name;
    document.getElementById("itemCategory").value = item.category;
    document.getElementById("itemQuantity").value = item.quantity;
    document.getElementById("itemPrice").value = item.price;
    document.getElementById("itemMinQuantity").value = item.min_quantity;
    document.getElementById("itemModalLabel").textContent = "Edit Item";
    const modal = new bootstrap.Modal(document.getElementById("itemModal"));
    modal.show();
  }

  async function saveItem() {
    const item = {
      name: document.getElementById("itemName").value,
      category: document.getElementById("itemCategory").value,
      quantity: parseInt(document.getElementById("itemQuantity").value),
      price: parseFloat(document.getElementById("itemPrice").value),
      min_quantity: parseInt(document.getElementById("itemMinQuantity").value),
    };
    const id = document.getElementById("editId").value;

    const method = id ? "PUT" : "POST";
    const url = id ? `${API_URL}/${id}` : API_URL;

    const res = await fetch(url, {
      method: method,
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(item),
    });

    if (res.ok) {
      renderTable();
      bootstrap.Modal.getInstance(document.getElementById("itemModal")).hide();
    } else {
      alert("Error saving item.");
    }
  }

  async function deleteItem(id) {
    if (!confirm("Are you sure you want to delete this item?")) return;
    const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
    if (res.ok) renderTable();
  }

  async function renderTable() {
    const res = await fetch(API_URL);
    const inventory = await res.json();
    const table = document.getElementById("inventoryTable");
    table.innerHTML = "";

    const categories = [...new Set(inventory.map(i => i.category))];

    categories.forEach(cat => {
      const headerRow = document.createElement("tr");
      headerRow.classList.add("table-primary");
      headerRow.innerHTML = `<td colspan="6"><strong>${cat}</strong></td>`;
      table.appendChild(headerRow);

      inventory.filter(i => i.category === cat).forEach(item => {
        const row = document.createElement("tr");
        if (item.quantity < item.min_quantity) row.classList.add("alert-low");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.category}</td>
          <td>${item.quantity}</td>
          <td>$${item.price.toFixed(2)}</td>
          <td>${item.min_quantity}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick='openEditModal(${JSON.stringify(item)})'>Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.product_id})">Delete</button>
          </td>
        `;
        table.appendChild(row);
      });
    });
  }

  renderTable();
</script>
</body>
</html>